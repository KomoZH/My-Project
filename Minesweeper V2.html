<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁªèÂÖ∏Êâ´Èõ∑Ê∏∏Êàè - Ëá™ÂÆö‰πâÁâà</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            width: 100%;
            max-width: 100%;
            color: #f0f0f0;
            border: 2px solid #4d79ff;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: #ffcc00;
            text-shadow: 0 0 8px rgba(255, 204, 0, 0.7);
            letter-spacing: 1.5px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #222;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 20px 0;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            border: 2px solid #444;
        }
        
        .flags-counter, .timer {
            font-size: 1.8rem;
            font-weight: bold;
            background: #111;
            border-radius: 5px;
            padding: 8px 15px;
            color: #ff4444;
            font-family: 'Courier New', monospace;
            min-width: 80px;
            text-align: center;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.7);
        }
        
        .reset-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 2.2rem;
            background: linear-gradient(to bottom, #ffcc00, #ff8800);
            border: 3px solid #444;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .reset-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
        }
        
        .reset-btn:active {
            transform: scale(0.95);
        }
        
        .difficulty-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .difficulty-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            background: #333;
            color: #ddd;
        }
        
        .difficulty-btn.active {
            background: linear-gradient(to bottom, #4d79ff, #1a3c99);
            color: white;
            box-shadow: 0 0 10px rgba(77, 121, 255, 0.7);
        }
        
        .difficulty-btn:hover {
            transform: translateY(-2px);
        }
        
        .game-board-container {
            overflow-x: auto;
            padding: 10px 0;
            margin: 0 auto;
        }
        
        .game-board {
            background: #888;
            padding: 12px;
            border-radius: 8px;
            margin: 20px auto;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.3);
            border: 4px solid #777;
            display: grid;
            gap: 2px;
        }
        
        /* ‰∏çÂêåÈöæÂ∫¶Á∫ßÂà´ÁöÑÊ£ãÁõòÂ§ßÂ∞è */
        .beginner .game-board {
            grid-template-columns: repeat(9, 1fr);
            width: fit-content;
        }
        
        .intermediate .game-board {
            grid-template-columns: repeat(16, 1fr);
            width: fit-content;
        }
        
        .expert .game-board {
            grid-template-columns: repeat(30, 1fr);
            width: fit-content;
        }
        
        .custom .game-board {
            width: fit-content;
        }
        
        .cell {
            aspect-ratio: 1;
            background: #c0c0c0;
            border-radius: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
            box-shadow: inset -2px -2px 3px rgba(0,0,0,0.2), 
                        inset 2px 2px 3px rgba(255,255,255,0.2);
            transition: background 0.2s;
            min-width: 25px;
            min-height: 25px;
        }
        
        .cell:hover {
            background: #d0d0d0;
        }
        
        .cell.revealed {
            background: #e0e0e0;
            box-shadow: none;
        }
        
        .cell.mine.revealed {
            background: #ff5555;
        }
        
        .cell.flagged::after {
            content: 'üö©';
            position: absolute;
        }
        
        .number-1 { color: blue; }
        .number-2 { color: green; }
        .number-3 { color: red; }
        .number-4 { color: darkblue; }
        .number-5 { color: darkred; }
        .number-6 { color: teal; }
        .number-7 { color: black; }
        .number-8 { color: gray; }
        
        .game-message {
            text-align: center;
            font-size: 1.5rem;
            min-height: 40px;
            margin: 15px 0;
            color: #ffcc00;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .instructions {
            margin-top: 25px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .instructions h3 {
            color: #4d79ff;
            margin-bottom: 10px;
        }
        
        .instructions p {
            margin: 8px 0;
        }
        
        /* Ëá™ÂÆö‰πâËÆæÁΩÆÂºπÁ™ó */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .custom-modal.active {
            display: flex;
        }
        
        .custom-form {
            background: #2a2a4a;
            padding: 25px;
            border-radius: 12px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.8);
            border: 2px solid #4d79ff;
        }
        
        .custom-form h2 {
            text-align: center;
            color: #ffcc00;
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 120px;
            margin: 5px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #ddd;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #555;
            background: #222;
            color: white;
        }
        
        .error-message {
            color: #ff5555;
            font-size: 0.9rem;
            display: none;
            margin-top: 3px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }
        
        .confirm-btn {
            background: linear-gradient(to right, #4d79ff, #1a3c99);
            color: white;
        }
        
        .cancel-btn {
            background: #555;
            color: white;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        
        .mines-info {
            text-align: center;
            color: #ddd;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .max-mines {
            color: #ffcc00;
            font-weight: bold;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .difficulty-selector {
                flex-wrap: wrap;
            }
            
            .cell {
                min-width: 20px;
                min-height: 20px;
                font-size: 1rem;
            }
            
            .expert .cell {
                min-width: 15px;
                min-height: 15px;
                font-size: 0.8rem;
            }
            
            .custom-modal {
                padding: 10px;
            }
            
            .custom-form {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>Êâ´Èõ∑Ê∏∏Êàè</h1>
            <div class="difficulty-selector">
                <button class="difficulty-btn active" data-difficulty="beginner">ÂàùÁ∫ß (9√ó9)</button>
                <button class="difficulty-btn" data-difficulty="intermediate">‰∏≠Á∫ß (16√ó16)</button>
                <button class="difficulty-btn" data-difficulty="expert">È´òÁ∫ß (16√ó30)</button>
                <button class="difficulty-btn" id="custom-difficulty-btn">Ëá™ÂÆö‰πâ</button>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="flags-counter">üö© <span id="flags-count">10</span></div>
            <button class="reset-btn">üòä</button>
            <div class="timer">‚è±Ô∏è <span id="time">0</span>s</div>
        </div>
        
        <div class="game-message" id="game-message">ÁÇπÂáªÁ¨ëËÑ∏ÂºÄÂßãÊ∏∏ÊàèÔºÅ</div>
        
        <div class="game-board-container">
            <div class="game-board" id="game-board">
                <!-- Ê∏∏ÊàèÊ†ºÂ≠êÁî±JavaScriptÁîüÊàê -->
            </div>
        </div>
        
        <div class="instructions">
            <h3>Ê∏∏ÊàèËßÑÂàô</h3>
            <p>‚Ä¢ Â∑¶ÈîÆÁÇπÂáªÊ†ºÂ≠êÔºöÁøªÂºÄÊ†ºÂ≠ê</p>
            <p>‚Ä¢ Âè≥ÈîÆÁÇπÂáªÊ†ºÂ≠êÔºöÊîæÁΩÆ/ÁßªÈô§ÊóóÂ∏úÊ†áËÆ∞Ôºàüö©Ôºâ</p>
            <p>‚Ä¢ ÁøªÂºÄÊâÄÊúâ‰∏çÂê´Âú∞Èõ∑ÁöÑÊ†ºÂ≠êÂç≥ÂèØËé∑ËÉú</p>
            <p>‚Ä¢ Êï∞Â≠óË°®Á§∫Âë®Âõ¥8Ê†º‰∏≠ÁöÑÂú∞Èõ∑Êï∞Èáè</p>
        </div>
    </div>
    
    <!-- Ëá™ÂÆö‰πâÈöæÂ∫¶ËÆæÁΩÆÂºπÁ™ó -->
    <div class="custom-modal" id="custom-modal">
        <div class="custom-form">
            <h2>Ëá™ÂÆö‰πâÊ∏∏ÊàèËÆæÁΩÆ</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="custom-rows">Ë°åÊï∞ (1-30)</label>
                    <input type="number" id="custom-rows" min="1" max="30" value="9">
                </div>
                <div class="form-group">
                    <label for="custom-cols">ÂàóÊï∞ (1-30)</label>
                    <input type="number" id="custom-cols" min="1" max="30" value="9">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="custom-mines">Âú∞Èõ∑Êï∞Èáè</label>
                    <input type="number" id="custom-mines" min="1" value="10">
                    <div class="error-message" id="mines-error">Âú∞Èõ∑Êï∞‰∏çËÉΩË∂ÖËøáÊ†ºÂ≠êÊï∞ÁöÑ75%</div>
                </div>
            </div>
            
            <div class="mines-info">
                ÊúÄÂ§ßÂú∞Èõ∑Êï∞: <span id="max-mines" class="max-mines">60</span>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" id="cancel-custom">ÂèñÊ∂à</button>
                <button class="modal-btn confirm-btn" id="confirm-custom">ÂºÄÂßãÊ∏∏Êàè</button>
            </div>
        </div>
    </div>

    <script>
        // Ê∏∏ÊàèÂ∏∏Èáè
        const DIFFICULTIES = {
            beginner: { rows: 9, cols: 9, mines: 10 },
            intermediate: { rows: 16, cols: 16, mines: 40 },
            expert: { rows: 16, cols: 30, mines: 99 },
            custom: { rows: 9, cols: 9, mines: 10 }
        };
        
        // Ê∏∏ÊàèÁä∂ÊÄÅ
        let gameState = {
            difficulty: 'beginner',
            board: [],
            mines: [],
            flags: [],
            revealed: [],
            gameOver: false,
            gameWon: false,
            startTime: null,
            timer: null,
            firstClick: true
        };
        
        // DOM ÂÖÉÁ¥†
        const gameBoard = document.getElementById('game-board');
        const flagsCountElement = document.getElementById('flags-count');
        const timerElement = document.getElementById('time');
        const resetButton = document.querySelector('.reset-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const customDifficultyButton = document.getElementById('custom-difficulty-btn');
        const gameMessage = document.getElementById('game-message');
        const gameBoardContainer = document.querySelector('.game-board-container');
        const customModal = document.getElementById('custom-modal');
        const cancelCustomButton = document.getElementById('cancel-custom');
        const confirmCustomButton = document.getElementById('confirm-custom');
        const customRowsInput = document.getElementById('custom-rows');
        const customColsInput = document.getElementById('custom-cols');
        const customMinesInput = document.getElementById('custom-mines');
        const maxMinesElement = document.getElementById('max-mines');
        const minesError = document.getElementById('mines-error');
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            const diff = DIFFICULTIES[gameState.difficulty];
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            gameState.mines = [];
            gameState.flags = [];
            gameState.revealed = [];
            gameState.gameOver = false;
            gameState.gameWon = false;
            gameState.firstClick = true;
            
            // ÂÅúÊ≠¢‰πãÂâçÁöÑËÆ°Êó∂Âô®
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            timerElement.textContent = '0';
            resetButton.textContent = 'üòä';
            gameMessage.textContent = 'Ê∏∏ÊàèÂºÄÂßãÔºÅÁÇπÂáªÊ†ºÂ≠êÁøªÂºÄ';
            
            // ËÆæÁΩÆÂÆπÂô®Á±ªÂêç‰ª•Â∫îÁî®Ê≠£Á°ÆÁöÑÊ†∑Âºè
            gameBoardContainer.className = 'game-board-container ' + gameState.difficulty;
            gameBoard.className = 'game-board ' + gameState.difficulty;
            
            // Ëá™ÂÆö‰πâÈöæÂ∫¶ËÆæÁΩÆÊ£ãÁõòÂàóÊï∞
            if (gameState.difficulty === 'custom') {
                gameBoard.style.gridTemplateColumns = `repeat(${diff.cols}, 1fr)`;
            } else {
                gameBoard.style.gridTemplateColumns = '';
            }
            
            // ÂàùÂßãÂåñÊ£ãÁõò
            gameState.board = [];
            for (let row = 0; row < diff.rows; row++) {
                const newRow = [];
                for (let col = 0; col < diff.cols; col++) {
                    newRow.push({
                        isMine: false,
                        adjacentMines: 0,
                        isFlagged: false,
                        isRevealed: false
                    });
                }
                gameState.board.push(newRow);
            }
            
            // Êõ¥Êñ∞Ââ©‰ΩôÊóóÂ∏úÊï∞Èáè
            flagsCountElement.textContent = diff.mines;
            
            // Ê∏≤ÊüìÊ£ãÁõò
            renderBoard();
        }
        
        // Âú®Á¨¨‰∏ÄÊ¨°ÁÇπÂáªÂêéÂ∏ÉÁΩÆÂú∞Èõ∑
        function placeMines(firstRow, firstCol) {
            const diff = DIFFICULTIES[gameState.difficulty];
            const rows = diff.rows;
            const cols = diff.cols;
            const mineCount = diff.mines;
            let minesPlanted = 0;
            
            while (minesPlanted < mineCount) {
                const randomRow = Math.floor(Math.random() * rows);
                const randomCol = Math.floor(Math.random() * cols);
                
                // Á°Æ‰øùÂú∞Èõ∑‰∏çÂú®Á¨¨‰∏ÄÊ¨°ÁÇπÂáªÁöÑÊ†ºÂ≠êÂíåÂë®Âõ¥
                const isNearFirstClick = 
                    Math.abs(randomRow - firstRow) <= 1 && 
                    Math.abs(randomCol - firstCol) <= 1;
                
                // Á°Æ‰øùÂú∞Èõ∑‰ΩçÁΩÆ‰∏çÈáçÂ§ç
                if (!gameState.board[randomRow][randomCol].isMine && !isNearFirstClick) {
                    gameState.board[randomRow][randomCol].isMine = true;
                    gameState.mines.push({row: randomRow, col: randomCol});
                    minesPlanted++;
                    
                    // Êõ¥Êñ∞Áõ∏ÈÇªÊ†ºÂ≠êÁöÑËÆ°Êï∞
                    updateAdjacentCount(randomRow, randomCol);
                }
            }
        }
        
        // Êõ¥Êñ∞Áõ∏ÈÇªÂú∞Èõ∑ËÆ°Êï∞
        function updateAdjacentCount(row, col) {
            const diff = DIFFICULTIES[gameState.difficulty];
            for (let r = Math.max(0, row - 1); r <= Math.min(diff.rows - 1, row + 1); r++) {
                for (let c = Math.max(0, col - 1); c <= Math.min(diff.cols - 1, col + 1); c++) {
                    if (r === row && c === col) continue; // Ë∑≥ËøáËá™Ë∫´
                    gameState.board[r][c].adjacentMines++;
                }
            }
        }
        
        // Ê∏≤ÊüìÊ∏∏ÊàèÊùø
        function renderBoard() {
            gameBoard.innerHTML = '';
            
            const diff = DIFFICULTIES[gameState.difficulty];
            const rows = diff.rows;
            const cols = diff.cols;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    const cellData = gameState.board[row][col];
                    
                    if (cellData.isRevealed) {
                        cell.classList.add('revealed');
                        if (cellData.isMine) {
                            cell.classList.add('mine');
                            cell.innerHTML = 'üí£';
                        } else if (cellData.adjacentMines > 0) {
                            cell.classList.add('number-' + cellData.adjacentMines);
                            cell.textContent = cellData.adjacentMines;
                        }
                    } else if (cellData.isFlagged) {
                        cell.classList.add('flagged');
                    }
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    cell.addEventListener('click', () => handleLeftClick(row, col));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(row, col);
                    });
                    
                    gameBoard.appendChild(cell);
                }
            }
        }
        
        // Â§ÑÁêÜÂ∑¶ÈîÆÁÇπÂáªÔºàÁøªÂºÄÊ†ºÂ≠êÔºâ
        function handleLeftClick(row, col) {
            // Ê£ÄÊü•Ê∏∏ÊàèÁä∂ÊÄÅ
            if (gameState.gameOver || gameState.gameWon || gameState.board[row][col].isFlagged) {
                return;
            }
            
            // Â¶ÇÊûúÊòØÁ¨¨‰∏ÄÊ¨°ÁÇπÂáªÔºåÊîæÁΩÆÂú∞Èõ∑Âπ∂ÂºÄÂßãËÆ°Êó∂
            if (gameState.firstClick) {
                placeMines(row, col);
                startTimer();
                gameState.firstClick = false;
            }
            
            // ÁøªÂºÄÊ†ºÂ≠ê
            revealCell(row, col);
            
            // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶ÁªìÊùü
            checkGameStatus();
        }
        
        // Â§ÑÁêÜÂè≥ÈîÆÁÇπÂáªÔºàÊ†áËÆ∞ÊóóÂ∏úÔºâ
        function handleRightClick(row, col) {
            if (gameState.gameOver || gameState.gameWon || gameState.board[row][col].isRevealed) {
                return;
            }
            
            const cell = gameState.board[row][col];
            const diff = DIFFICULTIES[gameState.difficulty];
            
            if (!cell.isFlagged && gameState.flags.length < diff.mines) {
                // ÊîæÁΩÆÊóóÂ∏ú
                cell.isFlagged = true;
                gameState.flags.push({row, col});
                flagsCountElement.textContent = diff.mines - gameState.flags.length;
            } else if (cell.isFlagged) {
                // ÁßªÈô§ÊóóÂ∏ú
                cell.isFlagged = false;
                gameState.flags = gameState.flags.filter(flag => !(flag.row === row && flag.col === col));
                flagsCountElement.textContent = diff.mines - gameState.flags.length;
            }
            
            renderBoard();
        }
        
        // ÁøªÂºÄÊ†ºÂ≠êÔºàÈÄíÂΩíÂÆûÁé∞Á©∫ÁôΩÂå∫ÂüüÊâ©Â±ïÔºâ
        function revealCell(row, col) {
            const diff = DIFFICULTIES[gameState.difficulty];
            
            // ËæπÁïåÊ£ÄÊü•ÊàñÂ∑≤ÁªèÁøªÂºÄ
            if (row < 0 || row >= diff.rows || 
                col < 0 || col >= diff.cols ||
                gameState.board[row][col].isRevealed) {
                return;
            }
            
            // Ê†áËÆ∞‰∏∫Â∑≤ÁøªÂºÄ
            gameState.board[row][col].isRevealed = true;
            gameState.revealed.push({row, col});
            
            // Â¶ÇÊûúÊòØÂú∞Èõ∑ÔºåÊ∏∏ÊàèÁªìÊùü
            if (gameState.board[row][col].isMine) {
                revealAllMines();
                gameState.gameOver = true;
                resetButton.textContent = 'üòµ';
                gameMessage.textContent = 'Ê∏∏ÊàèÁªìÊùüÔºÅ‰Ω†Ë∏©Âà∞Âú∞Èõ∑‰∫ÜÔºÅ';
                return;
            }
            
            // Â¶ÇÊûúÊòØÁ©∫ÁôΩÔºåÈÄíÂΩíÁøªÂºÄÁõ∏ÈÇªÊ†ºÂ≠ê
            if (gameState.board[row][col].adjacentMines === 0) {
                for (let r = row - 1; r <= row + 1; r++) {
                    for (let c = col - 1; c <= col + 1; c++) {
                        // Ë∑≥ËøáËá™Ë∫´
                        if (r === row && c === col) continue;
                        revealCell(r, c);
                    }
                }
            }
            
            renderBoard();
        }
        
        // ÁøªÂºÄÊâÄÊúâÂú∞Èõ∑ÔºàÊ∏∏ÊàèÁªìÊùüÊó∂Ôºâ
        function revealAllMines() {
            for (const mine of gameState.mines) {
                gameState.board[mine.row][mine.col].isRevealed = true;
            }
            renderBoard();
        }
        
        // Ê£ÄÊü•Ê∏∏ÊàèËÉúÂà©Êù°‰ª∂
        function checkGameStatus() {
            const diff = DIFFICULTIES[gameState.difficulty];
            const totalSafeCells = diff.rows * diff.cols - diff.mines;
            
            if (gameState.revealed.length === totalSafeCells) {
                gameState.gameWon = true;
                resetButton.textContent = 'üòé';
                gameMessage.textContent = 'ÊÅ≠ÂñúÔºÅ‰Ω†Ëµ¢‰∫ÜÔºÅ';
                clearInterval(gameState.timer);
            }
        }
        
        // ÂºÄÂßãËÆ°Êó∂Âô®
        function startTimer() {
            gameState.startTime = new Date();
            gameState.timer = setInterval(() => {
                const seconds = Math.floor((new Date() - gameState.startTime) / 1000);
                timerElement.textContent = seconds;
            }, 1000);
        }
        
        // Êõ¥Êñ∞ÊúÄÂ§ßÂú∞Èõ∑Êï∞ÊòæÁ§∫
        function updateMaxMinesDisplay() {
            const rows = parseInt(customRowsInput.value) || 9;
            const cols = parseInt(customColsInput.value) || 9;
            const totalCells = rows * cols;
            const maxMines = Math.floor(totalCells * 0.75);
            maxMinesElement.textContent = maxMines;
            customMinesInput.max = maxMines;
        }
        
        // È™åËØÅËá™ÂÆö‰πâËÆæÁΩÆ
        function validateCustomSettings() {
            const rows = parseInt(customRowsInput.value);
            const cols = parseInt(customColsInput.value);
            const mines = parseInt(customMinesInput.value);
            
            // È™åËØÅËæìÂÖ•ÂÄº
            if (isNaN(rows) || isNaN(cols) || isNaN(mines)) {
                gameMessage.textContent = 'ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµÔºÅ';
                return false;
            }
            
            if (rows < 1 || rows > 30) {
                gameMessage.textContent = 'Ë°åÊï∞ÂøÖÈ°ªÊòØ1-30‰πãÈó¥ÁöÑÊï¥Êï∞ÔºÅ';
                return false;
            }
            
            if (cols < 1 || cols > 30) {
                gameMessage.textContent = 'ÂàóÊï∞ÂøÖÈ°ªÊòØ1-30‰πãÈó¥ÁöÑÊï¥Êï∞ÔºÅ';
                return false;
            }
            
            const totalCells = rows * cols;
            const maxMines = Math.floor(totalCells * 0.75);
            
            if (mines < 1 || mines > maxMines) {
                minesError.style.display = 'block';
                gameMessage.textContent = `Âú∞Èõ∑Êï∞ËåÉÂõ¥‰∏∫1-${maxMines}ÔºÅ`;
                return false;
            }
            
            minesError.style.display = 'none';
            return true;
        }
        
        // ‰∫ã‰ª∂ÁõëÂê¨Âô®
        resetButton.addEventListener('click', () => {
            // Ê∏ÖÈô§ËÆ°Êó∂Âô®
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            initGame();
        });
        
        difficultyButtons.forEach(button => {
            button.addEventListener('click', function() {
                // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑactiveÁ±ª
                difficultyButtons.forEach(b => b.classList.remove('active'));
                // ‰∏∫ÂΩìÂâçÊåâÈíÆÊ∑ªÂä†activeÁ±ª
                this.classList.add('active');
                
                if (this !== customDifficultyButton) {
                    gameState.difficulty = this.dataset.difficulty;
                    initGame();
                }
            });
        });
        
        // Ëá™ÂÆö‰πâÈöæÂ∫¶ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
        customDifficultyButton.addEventListener('click', function() {
            // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑactiveÁ±ªÔºåÂΩìÂâçÊåâÈíÆÊ∑ªÂä†activeÁ±ª
            difficultyButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // ËÆæÁΩÆÈªòËÆ§ÂÄº
            const diff = DIFFICULTIES[gameState.difficulty === 'custom' ? 'custom' : 'beginner'];
            customRowsInput.value = diff.rows;
            customColsInput.value = diff.cols;
            customMinesInput.value = diff.mines;
            updateMaxMinesDisplay();
            
            // ÊòæÁ§∫Ëá™ÂÆö‰πâËÆæÁΩÆÂºπÁ™ó
            customModal.classList.add('active');
        });
        
        // ËÆ°ÁÆóÊúÄÂ§ßÂú∞Èõ∑Êï∞
        customRowsInput.addEventListener('input', updateMaxMinesDisplay);
        customColsInput.addEventListener('input', updateMaxMinesDisplay);
        
        // ÂèñÊ∂àËá™ÂÆö‰πâËÆæÁΩÆ
        cancelCustomButton.addEventListener('click', function() {
            customModal.classList.remove('active');
            // ÈáçÁΩÆËá™ÂÆö‰πâÊåâÈíÆÁä∂ÊÄÅ
            difficultyButtons.forEach(b => {
                if (b.dataset.difficulty === gameState.difficulty) {
                    b.classList.add('active');
                }
            });
        });
        
        // Á°ÆËÆ§Ëá™ÂÆö‰πâËÆæÁΩÆ
        confirmCustomButton.addEventListener('click', function() {
            if (validateCustomSettings()) {
                // Êõ¥Êñ∞Ëá™ÂÆö‰πâÈöæÂ∫¶ËÆæÁΩÆ
                DIFFICULTIES.custom.rows = parseInt(customRowsInput.value);
                DIFFICULTIES.custom.cols = parseInt(customColsInput.value);
                DIFFICULTIES.custom.mines = parseInt(customMinesInput.value);
                
                gameState.difficulty = 'custom';
                customModal.classList.remove('active');
                
                // Êõ¥Êñ∞Ê∂àÊÅØÂå∫Âüü
                gameMessage.textContent = `Ëá™ÂÆö‰πâÈöæÂ∫¶: ${DIFFICULTIES.custom.rows}√ó${DIFFICULTIES.custom.cols}, Âú∞Èõ∑: ${DIFFICULTIES.custom.mines}`;
                
                // ÂàùÂßãÂåñÊ∏∏Êàè
                initGame();
            }
        });
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        initGame();
        // ËÆ°ÁÆóÊúÄÂ§ßÂú∞Èõ∑Êï∞
        updateMaxMinesDisplay();
    </script>
</body>
</html>