<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»å…¸æ‰«é›·æ¸¸æˆ - è‡ªå®šä¹‰ç‰ˆï¼ˆå¸¦ä½œå¼Šæ¨¡å¼ï¼‰</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            background: rgba(30, 30, 50, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            width: 100%;
            max-width: 100%;
            color: #f0f0f0;
            border: 2px solid #4d79ff;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: #ffcc00;
            text-shadow: 0 0 8px rgba(255, 204, 0, 0.7);
            letter-spacing: 1.5px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #222;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 20px 0;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            border: 2px solid #444;
        }
        
        .flags-counter, .timer {
            font-size: 1.8rem;
            font-weight: bold;
            background: #111;
            border-radius: 5px;
            padding: 8px 15px;
            color: #ff4444;
            font-family: 'Courier New', monospace;
            min-width: 80px;
            text-align: center;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.7);
        }
        
        .reset-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 2.2rem;
            background: linear-gradient(to bottom, #ffcc00, #ff8800);
            border: 3px solid #444;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .reset-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
        }
        
        .reset-btn:active {
            transform: scale(0.95);
        }
        
        .difficulty-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }
        
        .difficulty-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            background: #333;
            color: #ddd;
        }
        
        .difficulty-btn.active {
            background: linear-gradient(to bottom, #4d79ff, #1a3c99);
            color: white;
            box-shadow: 0 0 10px rgba(77, 121, 255, 0.7);
        }
        
        .difficulty-btn:hover {
            transform: translateY(-2px);
        }
        
        .cheat-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s;
            background: linear-gradient(to bottom, #ff6b6b, #c0392b);
            color: white;
            margin-left: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        
        .cheat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.4);
        }
        
        .cheat-btn.active {
            background: linear-gradient(to bottom, #1abc9c, #16a085);
            box-shadow: 0 0 12px rgba(46, 204, 113, 0.7);
        }
        
        .game-board-container {
            overflow-x: auto;
            padding: 10px 0;
            margin: 0 auto;
        }
        
        .game-board {
            background: #888;
            padding: 12px;
            border-radius: 8px;
            margin: 20px auto;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.3);
            border: 4px solid #777;
            display: grid;
            gap: 2px;
        }
        
        /* ä¸åŒéš¾åº¦çº§åˆ«çš„æ£‹ç›˜å¤§å° */
        .beginner .game-board {
            grid-template-columns: repeat(9, 1fr);
            width: fit-content;
        }
        
        .intermediate .game-board {
            grid-template-columns: repeat(16, 1fr);
            width: fit-content;
        }
        
        .expert .game-board {
            grid-template-columns: repeat(30, 1fr);
            width: fit-content;
        }
        
        .custom .game-board {
            width: fit-content;
        }
        
        .cell {
            aspect-ratio: 1;
            background: #c0c0c0;
            border-radius: 3px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
            box-shadow: inset -2px -2px 3px rgba(0,0,0,0.2), 
                        inset 2px 2px 3px rgba(255,255,255,0.2);
            transition: background 0.2s;
            min-width: 25px;
            min-height: 25px;
        }
        
        .cell:hover {
            background: #d0d0d0;
        }
        
        .cell.revealed {
            background: #e0e0e0;
            box-shadow: none;
        }
        
        .cell.mine.revealed {
            background: #ff5555;
        }
        
        .cell.flagged::after {
            content: 'ğŸš©';
            position: absolute;
        }
        
        .number-1 { color: blue; }
        .number-2 { color: green; }
        .number-3 { color: red; }
        .number-4 { color: darkblue; }
        .number-5 { color: darkred; }
        .number-6 { color: teal; }
        .number-7 { color: black; }
        .number-8 { color: gray; }
        
        /* AIæç¤ºæ ·å¼ */
        .cell.hint-safe {
            box-shadow: 0 0 0 3px #2ecc71;
            animation: pulse-green 1.5s infinite;
        }
        
        .cell.hint-mine {
            box-shadow: 0 0 0 3px #e74c3c;
            animation: pulse-red 1.5s infinite;
        }
        
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            70% { box-shadow: 0 0 0 8px rgba(46, 204, 113, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 8px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        
        .game-message {
            text-align: center;
            font-size: 1.5rem;
            min-height: 40px;
            margin: 15px 0;
            color: #ffcc00;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .instructions {
            margin-top: 25px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .instructions h3 {
            color: #4d79ff;
            margin-bottom: 10px;
        }
        
        .instructions p {
            margin: 8px 0;
        }
        
        /* è‡ªå®šä¹‰è®¾ç½®å¼¹çª— */
        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }
        
        .custom-modal.active {
            display: flex;
        }
        
        .custom-form {
            background: #2a2a4a;
            padding: 25px;
            border-radius: 12px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.8);
            border: 2px solid #4d79ff;
        }
        
        .custom-form h2 {
            text-align: center;
            color: #ffcc00;
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 120px;
            margin: 5px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #ddd;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #555;
            background: #222;
            color: white;
        }
        
        .error-message {
            color: #ff5555;
            font-size: 0.9rem;
            display: none;
            margin-top: 3px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }
        
        .confirm-btn {
            background: linear-gradient(to right, #4d79ff, #1a3c99);
            color: white;
        }
        
        .cancel-btn {
            background: #555;
            color: white;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        
        .mines-info {
            text-align: center;
            color: #ddd;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .max-mines {
            color: #ffcc00;
            font-weight: bold;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .difficulty-selector {
                flex-wrap: wrap;
            }
            
            .cell {
                min-width: 20px;
                min-height: 20px;
                font-size: 1rem;
            }
            
            .expert .cell {
                min-width: 15px;
                min-height: 15px;
                font-size: 0.8rem;
            }
            
            .custom-modal {
                padding: 10px;
            }
            
            .custom-form {
                padding: 15px;
            }
            
            .cheat-btn {
                margin-top: 10px;
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>æ‰«é›·æ¸¸æˆ</h1>
            <div class="difficulty-selector">
                <button class="difficulty-btn active" data-difficulty="beginner">åˆçº§ (9Ã—9)</button>
                <button class="difficulty-btn" data-difficulty="intermediate">ä¸­çº§ (16Ã—16)</button>
                <button class="difficulty-btn" data-difficulty="expert">é«˜çº§ (16Ã—30)</button>
                <button class="difficulty-btn" id="custom-difficulty-btn">è‡ªå®šä¹‰</button>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="flags-counter">ğŸš© <span id="flags-count">10</span></div>
            <button class="reset-btn">ğŸ˜Š</button>
            <div class="timer">â±ï¸ <span id="time">0</span>s</div>
        </div>
        
        <div class="game-message" id="game-message">ç‚¹å‡»ç¬‘è„¸å¼€å§‹æ¸¸æˆï¼</div>
        
        <button class="cheat-btn" id="cheat-btn">ä½œå¼Šæ¨¡å¼ï¼šå…³</button>
        
        <div class="game-board-container">
            <div class="game-board" id="game-board">
                <!-- æ¸¸æˆæ ¼å­ç”±JavaScriptç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="instructions">
            <h3>æ¸¸æˆè§„åˆ™</h3>
            <p>â€¢ å·¦é”®ç‚¹å‡»æ ¼å­ï¼šç¿»å¼€æ ¼å­</p>
            <p>â€¢ å³é”®ç‚¹å‡»æ ¼å­ï¼šæ”¾ç½®/ç§»é™¤æ——å¸œæ ‡è®°ï¼ˆğŸš©ï¼‰</p>
            <p>â€¢ ç¿»å¼€æ‰€æœ‰ä¸å«åœ°é›·çš„æ ¼å­å³å¯è·èƒœ</p>
            <p>â€¢ æ•°å­—è¡¨ç¤ºå‘¨å›´8æ ¼ä¸­çš„åœ°é›·æ•°é‡</p>
            <p>â€¢ <strong>ä½œå¼Šæ¨¡å¼</strong>ï¼šAIä¼šæç¤ºä¸‹ä¸€æ­¥æ“ä½œï¼ˆç»¿è‰²ï¼šå®‰å…¨æ ¼å­ï¼Œçº¢è‰²ï¼šåœ°é›·ï¼‰</p>
            <p>â€¢ <strong>è‡ªå®šä¹‰æ¨¡å¼</strong>ï¼šåœ°é›·æ•°ä¸èƒ½è¶…è¿‡æ€»æ ¼å­æ•°çš„75%æˆ–æ€»æ ¼å­æ•°å‡9</p>
        </div>
    </div>
    
    <!-- è‡ªå®šä¹‰éš¾åº¦è®¾ç½®å¼¹çª— -->
    <div class="custom-modal" id="custom-modal">
        <div class="custom-form">
            <h2>è‡ªå®šä¹‰æ¸¸æˆè®¾ç½®</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="custom-rows">è¡Œæ•° (4-30)</label>
                    <input type="number" id="custom-rows" min="4" max="30" value="9">
                    <div class="error-message" id="mines-error">è¡Œæ•°ä¸èƒ½å°äº4æˆ–å¤§äº30</div>
                </div>
                <div class="form-group">
                    <label for="custom-cols">åˆ—æ•° (4-30)</label>
                    <input type="number" id="custom-cols" min="4" max="30" value="9">
                    <div class="error-message" id="mines-error">åˆ—æ•°ä¸èƒ½å°äº4æˆ–å¤§äº30</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="custom-mines">åœ°é›·æ•°é‡</label>
                    <input type="number" id="custom-mines" min="1" value="10">
                    <div class="error-message" id="mines-error">åœ°é›·æ•°ä¸èƒ½å°äºç­‰äº0æˆ–è¶…è¿‡æ€»æ ¼å­æ•°çš„75%æˆ–æ€»æ ¼å­æ•°å‡9</div>
                </div>
            </div>
            
            <div class="mines-info">
                æœ€å¤§åœ°é›·æ•°: <span id="max-mines" class="max-mines">60</span>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" id="cancel-custom">å–æ¶ˆ</button>
                <button class="modal-btn confirm-btn" id="confirm-custom">å¼€å§‹æ¸¸æˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆå¸¸é‡
        const DIFFICULTIES = {
            beginner: { rows: 9, cols: 9, mines: 10 },
            intermediate: { rows: 16, cols: 16, mines: 40 },
            expert: { rows: 16, cols: 30, mines: 99 },
            custom: { rows: 9, cols: 9, mines: 10 }
        };
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            difficulty: 'beginner',
            board: [],
            mines: [],
            flags: [],
            revealed: [],
            gameOver: false,
            gameWon: false,
            startTime: null,
            timer: null,
            firstClick: true,
            cheatMode: false
        };
        
        // DOM å…ƒç´ 
        const gameBoard = document.getElementById('game-board');
        const flagsCountElement = document.getElementById('flags-count');
        const timerElement = document.getElementById('time');
        const resetButton = document.querySelector('.reset-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const customDifficultyButton = document.getElementById('custom-difficulty-btn');
        const gameMessage = document.getElementById('game-message');
        const gameBoardContainer = document.querySelector('.game-board-container');
        const customModal = document.getElementById('custom-modal');
        const cancelCustomButton = document.getElementById('cancel-custom');
        const confirmCustomButton = document.getElementById('confirm-custom');
        const customRowsInput = document.getElementById('custom-rows');
        const customColsInput = document.getElementById('custom-cols');
        const customMinesInput = document.getElementById('custom-mines');
        const maxMinesElement = document.getElementById('max-mines');
        const minesError = document.getElementById('mines-error');
        const cheatButton = document.getElementById('cheat-btn');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            const diff = DIFFICULTIES[gameState.difficulty];
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.mines = [];
            gameState.flags = [];
            gameState.revealed = [];
            gameState.gameOver = false;
            gameState.gameWon = false;
            gameState.firstClick = true;
            gameState.cheatMode = false;
            cheatButton.textContent = "ä½œå¼Šæ¨¡å¼ï¼šå…³";
            cheatButton.classList.remove('active');
            
            // åœæ­¢ä¹‹å‰çš„è®¡æ—¶å™¨
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            timerElement.textContent = '0';
            resetButton.textContent = 'ğŸ˜Š';
            gameMessage.textContent = 'æ¸¸æˆå¼€å§‹ï¼ç‚¹å‡»æ ¼å­ç¿»å¼€';
            
            // è®¾ç½®å®¹å™¨ç±»åä»¥åº”ç”¨æ­£ç¡®çš„æ ·å¼
            gameBoardContainer.className = 'game-board-container ' + gameState.difficulty;
            gameBoard.className = 'game-board ' + gameState.difficulty;
            
            // è‡ªå®šä¹‰éš¾åº¦è®¾ç½®æ£‹ç›˜åˆ—æ•°
            if (gameState.difficulty === 'custom') {
                gameBoard.style.gridTemplateColumns = `repeat(${diff.cols}, 1fr)`;
            } else {
                gameBoard.style.gridTemplateColumns = '';
            }
            
            // åˆå§‹åŒ–æ£‹ç›˜
            gameState.board = [];
            for (let row = 0; row < diff.rows; row++) {
                const newRow = [];
                for (let col = 0; col < diff.cols; col++) {
                    newRow.push({
                        isMine: false,
                        adjacentMines: 0,
                        isFlagged: false,
                        isRevealed: false
                    });
                }
                gameState.board.push(newRow);
            }
            
            // æ›´æ–°å‰©ä½™æ——å¸œæ•°é‡
            flagsCountElement.textContent = diff.mines;
            
            // æ¸²æŸ“æ£‹ç›˜
            renderBoard();
        }
        
        // åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»åå¸ƒç½®åœ°é›·
        function placeMines(firstRow, firstCol) {
            const diff = DIFFICULTIES[gameState.difficulty];
            const rows = diff.rows;
            const cols = diff.cols;
            const mineCount = diff.mines;
            let minesPlanted = 0;
            let attempts = 0;
            const maxAttempts = 10000; // é˜²æ­¢æ­»å¾ªç¯
            
            while (minesPlanted < mineCount && attempts < maxAttempts) {
                const randomRow = Math.floor(Math.random() * rows);
                const randomCol = Math.floor(Math.random() * cols);
                
                // ç¡®ä¿åœ°é›·ä¸åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„æ ¼å­å’Œå‘¨å›´
                const isNearFirstClick = 
                    Math.abs(randomRow - firstRow) <= 1 && 
                    Math.abs(randomCol - firstCol) <= 1;
                
                // ç¡®ä¿åœ°é›·ä½ç½®ä¸é‡å¤
                if (!gameState.board[randomRow][randomCol].isMine && !isNearFirstClick) {
                    gameState.board[randomRow][randomCol].isMine = true;
                    gameState.mines.push({row: randomRow, col: randomCol});
                    minesPlanted++;
                    
                    // æ›´æ–°ç›¸é‚»æ ¼å­çš„è®¡æ•°
                    updateAdjacentCount(randomRow, randomCol);
                }
                
                attempts++;
            }
            
            // å¦‚æœå°è¯•æ¬¡æ•°è¿‡å¤šä»æœªæ”¾ç½®æ‰€æœ‰åœ°é›·
            if (minesPlanted < mineCount) {
                console.error(`æ— æ³•æ”¾ç½®æ‰€æœ‰åœ°é›·ï¼Œåªæ”¾ç½®äº†${minesPlanted}ä¸ª`);
                gameMessage.textContent = 'æ— æ³•æ”¾ç½®æ‰€æœ‰åœ°é›·ï¼è¯·å°è¯•å‡å°‘åœ°é›·æ•°é‡æˆ–å¢å¤§æ£‹ç›˜';
            }
        }
        
        // æ›´æ–°ç›¸é‚»åœ°é›·è®¡æ•°
        function updateAdjacentCount(row, col) {
            const diff = DIFFICULTIES[gameState.difficulty];
            for (let r = Math.max(0, row - 1); r <= Math.min(diff.rows - 1, row + 1); r++) {
                for (let c = Math.max(0, col - 1); c <= Math.min(diff.cols - 1, col + 1); c++) {
                    if (r === row && c === col) continue; // è·³è¿‡è‡ªèº«
                    gameState.board[r][c].adjacentMines++;
                }
            }
        }
        
        // æ¸²æŸ“æ¸¸æˆæ¿
        function renderBoard() {
            gameBoard.innerHTML = '';
            
            const diff = DIFFICULTIES[gameState.difficulty];
            const rows = diff.rows;
            const cols = diff.cols;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    const cellData = gameState.board[row][col];
                    
                    if (cellData.isRevealed) {
                        cell.classList.add('revealed');
                        if (cellData.isMine) {
                            cell.classList.add('mine');
                            cell.innerHTML = 'ğŸ’£';
                        } else if (cellData.adjacentMines > 0) {
                            cell.classList.add('number-' + cellData.adjacentMines);
                            cell.textContent = cellData.adjacentMines;
                        }
                    } else if (cellData.isFlagged) {
                        cell.classList.add('flagged');
                    }
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    cell.addEventListener('click', () => handleLeftClick(row, col));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(row, col);
                    });
                    
                    gameBoard.appendChild(cell);
                }
            }
            
            // å¦‚æœä½œå¼Šæ¨¡å¼å¼€å¯ï¼Œæ˜¾ç¤ºAIæç¤º
            if (gameState.cheatMode) {
                provideCheatHint();
            }
        }
        
        // æä¾›AIæç¤º
        function provideCheatHint() {
            // æ¸…é™¤ä¹‹å‰çš„æç¤º
            const previousHints = document.querySelectorAll('.hint-safe, .hint-mine');
            previousHints.forEach(cell => {
                cell.classList.remove('hint-safe', 'hint-mine');
            });
            
            // å¦‚æœæ¸¸æˆç»“æŸï¼Œä¸æä¾›æç¤º
            if (gameState.gameOver || gameState.gameWon) {
                return;
            }
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œæç¤ºç‚¹å‡»ä¸­å¿ƒä½ç½®
            if (gameState.firstClick) {
                const diff = DIFFICULTIES[gameState.difficulty];
                const centerRow = Math.floor(diff.rows / 2);
                const centerCol = Math.floor(diff.cols / 2);
                
                const cell = document.querySelector(`.cell[data-row="${centerRow}"][data-col="${centerCol}"]`);
                if (cell) {
                    cell.classList.add('hint-safe');
                }
                return;
            }
            
            // æŸ¥æ‰¾å®‰å…¨çš„æ ¼å­ï¼ˆå¯ä»¥ç¿»å¼€ï¼‰
            let safeCell = findSafeCell();
            if (safeCell) {
                const cell = document.querySelector(`.cell[data-row="${safeCell.row}"][data-col="${safeCell.col}"]`);
                if (cell) {
                    cell.classList.add('hint-safe');
                }
                return;
            }
            
            // æŸ¥æ‰¾è‚¯å®šæ˜¯åœ°é›·çš„æ ¼å­
            let mineCell = findMineCell();
            if (mineCell) {
                const cell = document.querySelector(`.cell[data-row="${mineCell.row}"][data-col="${mineCell.col}"]`);
                if (cell) {
                    cell.classList.add('hint-mine');
                }
                return;
            }
            
            // å¦‚æœæ‰¾ä¸åˆ°ç¡®å®šçš„æ ¼å­ï¼Œéšæœºæ‰¾ä¸€ä¸ªå®‰å…¨æ ¼å­
            const randomCell = findRandomSafeCell();
            if (randomCell) {
                const cell = document.querySelector(`.cell[data-row="${randomCell.row}"][data-col="${randomCell.col}"]`);
                if (cell) {
                    cell.classList.add('hint-safe');
                }
            }
        }
        
        // æŸ¥æ‰¾å®‰å…¨æ ¼å­ï¼ˆåŸºäºå·²çŸ¥ä¿¡æ¯ï¼‰
        function findSafeCell() {
            const diff = DIFFICULTIES[gameState.difficulty];
            
            // é¦–å…ˆå°è¯•æ‰¾åˆ°100%å®‰å…¨çš„æ ¼å­
            for (let row = 0; row < diff.rows; row++) {
                for (let col = 0; col < diff.cols; col++) {
                    const cell = gameState.board[row][col];
                    
                    // è·³è¿‡å·²ç¿»å¼€æˆ–å·²æ ‡è®°çš„æ ¼å­
                    if (cell.isRevealed || cell.isFlagged) continue;
                    
                    // å¦‚æœä¸€ä¸ªæ ¼å­å‘¨å›´æœ‰æ•°å­—æ ¼å­æ»¡è¶³ï¼šæ•°å­— = å‘¨å›´æ——å¸œæ•°
                    // é‚£ä¹ˆè¿™ä¸ªæ ¼å­æ˜¯å®‰å…¨çš„
                    for (let r = Math.max(0, row - 1); r <= Math.min(diff.rows - 1, row + 1); r++) {
                        for (let c = Math.max(0, col - 1); c <= Math.min(diff.cols - 1, col + 1); c++) {
                            if (r === row && c === col) continue;
                            
                            const neighbor = gameState.board[r][c];
                            if (neighbor.isRevealed && neighbor.adjacentMines > 0) {
                                let flagCount = 0;
                                let unRevealedCount = 0;
                                
                                // æ£€æŸ¥é‚»å±…çš„é‚»å±…
                                for (let nr = Math.max(0, r - 1); nr <= Math.min(diff.rows - 1, r + 1); nr++) {
                                    for (let nc = Math.max(0, c - 1); nc <= Math.min(diff.cols - 1, c + 1); nc++) {
                                        if (nr === r && nc === c) continue;
                                        
                                        const nneighbor = gameState.board[nr][nc];
                                        if (nneighbor.isFlagged) {
                                            flagCount++;
                                        } else if (!nneighbor.isRevealed) {
                                            unRevealedCount++;
                                        }
                                    }
                                }
                                
                                // å¦‚æœé‚»å±…çš„æ•°å­—ç­‰äºå‘¨å›´æ——å¸œæ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ¼å­æ˜¯å®‰å…¨çš„
                                if (neighbor.adjacentMines === flagCount) {
                                    return { row, col };
                                }
                            }
                        }
                    }
                }
            }
            
            return null;
        }
        
        // æŸ¥æ‰¾è‚¯å®šæ˜¯åœ°é›·çš„æ ¼å­
        function findMineCell() {
            const diff = DIFFICULTIES[gameState.difficulty];
            
            for (let row = 0; row < diff.rows; row++) {
                for (let col = 0; col < diff.cols; col++) {
                    const cell = gameState.board[row][col];
                    
                    // è·³è¿‡å·²ç¿»å¼€æˆ–å·²æ ‡è®°çš„æ ¼å­
                    if (cell.isRevealed || cell.isFlagged) continue;
                    
                    // æ£€æŸ¥å‘¨å›´çš„æ•°å­—æ ¼å­
                    for (let r = Math.max(0, row - 1); r <= Math.min(diff.rows - 1, row + 1); r++) {
                        for (let c = Math.max(0, col - 1); c <= Math.min(diff.cols - 1, col + 1); c++) {
                            if (r === row && c === col) continue;
                            
                            const neighbor = gameState.board[r][c];
                            if (neighbor.isRevealed && neighbor.adjacentMines > 0) {
                                let flagCount = 0;
                                let unRevealedCount = 0;
                                
                                // æ£€æŸ¥é‚»å±…çš„é‚»å±…
                                for (let nr = Math.max(0, r - 1); nr <= Math.min(diff.rows - 1, r + 1); nr++) {
                                    for (let nc = Math.max(0, c - 1); nc <= Math.min(diff.cols - 1, c + 1); nc++) {
                                        if (nr === r && nc === c) continue;
                                        
                                        const nneighbor = gameState.board[nr][nc];
                                        if (nneighbor.isFlagged) {
                                            flagCount++;
                                        } else if (!nneighbor.isRevealed) {
                                            unRevealedCount++;
                                        }
                                    }
                                }
                                
                                // å¦‚æœé‚»å±…çš„å‰©ä½™æœªç¿»å¼€æ ¼å­æ•°ç­‰äºå‰©ä½™åœ°é›·æ•°
                                if (neighbor.adjacentMines - flagCount === unRevealedCount) {
                                    return { row, col };
                                }
                            }
                        }
                    }
                }
            }
            
            return null;
        }
        
        // éšæœºæ‰¾ä¸€ä¸ªå®‰å…¨æ ¼å­ï¼ˆçŸ¥é“å®Œæ•´æ£‹ç›˜ï¼‰
        function findRandomSafeCell() {
            const diff = DIFFICULTIES[gameState.difficulty];
            const safeCells = [];
            
            for (let row = 0; row < diff.rows; row++) {
                for (let col = 0; col < diff.cols; col++) {
                    const cell = gameState.board[row][col];
                    
                    // è·³è¿‡å·²ç¿»å¼€ã€å·²æ ‡è®°æˆ–åœ°é›·æ ¼å­
                    if (!cell.isRevealed && !cell.isFlagged && !cell.isMine) {
                        safeCells.push({ row, col });
                    }
                }
            }
            
            if (safeCells.length > 0) {
                const randomIndex = Math.floor(Math.random() * safeCells.length);
                return safeCells[randomIndex];
            }
            
            return null;
        }
        
        // å¤„ç†å·¦é”®ç‚¹å‡»ï¼ˆç¿»å¼€æ ¼å­ï¼‰
        function handleLeftClick(row, col) {
            // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
            if (gameState.gameOver || gameState.gameWon || gameState.board[row][col].isFlagged) {
                return;
            }
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œæ”¾ç½®åœ°é›·å¹¶å¼€å§‹è®¡æ—¶
            if (gameState.firstClick) {
                placeMines(row, col);
                startTimer();
                gameState.firstClick = false;
            }
            
            // ç¿»å¼€æ ¼å­
            revealCell(row, col);
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            checkGameStatus();
            
            // å¦‚æœä½œå¼Šæ¨¡å¼å¼€å¯ï¼Œæ›´æ–°æç¤º
            if (gameState.cheatMode) {
                provideCheatHint();
            }
        }
        
        // å¤„ç†å³é”®ç‚¹å‡»ï¼ˆæ ‡è®°æ——å¸œï¼‰
        function handleRightClick(row, col) {
            if (gameState.gameOver || gameState.gameWon || gameState.board[row][col].isRevealed) {
                return;
            }
            
            const cell = gameState.board[row][col];
            const diff = DIFFICULTIES[gameState.difficulty];
            
            if (!cell.isFlagged && gameState.flags.length < diff.mines) {
                // æ”¾ç½®æ——å¸œ
                cell.isFlagged = true;
                gameState.flags.push({row, col});
                flagsCountElement.textContent = diff.mines - gameState.flags.length;
            } else if (cell.isFlagged) {
                // ç§»é™¤æ——å¸œ
                cell.isFlagged = false;
                gameState.flags = gameState.flags.filter(flag => !(flag.row === row && flag.col === col));
                flagsCountElement.textContent = diff.mines - gameState.flags.length;
            }
            
            renderBoard();
        }
        
        // ç¿»å¼€æ ¼å­ï¼ˆé€’å½’å®ç°ç©ºç™½åŒºåŸŸæ‰©å±•ï¼‰
        function revealCell(row, col) {
            const diff = DIFFICULTIES[gameState.difficulty];
            
            // è¾¹ç•Œæ£€æŸ¥æˆ–å·²ç»ç¿»å¼€
            if (row < 0 || row >= diff.rows || 
                col < 0 || col >= diff.cols ||
                gameState.board[row][col].isRevealed) {
                return;
            }
            
            // æ ‡è®°ä¸ºå·²ç¿»å¼€
            gameState.board[row][col].isRevealed = true;
            gameState.revealed.push({row, col});
            
            // å¦‚æœæ˜¯åœ°é›·ï¼Œæ¸¸æˆç»“æŸ
            if (gameState.board[row][col].isMine) {
                revealAllMines();
                gameState.gameOver = true;
                resetButton.textContent = 'ğŸ˜µ';
                gameMessage.textContent = 'æ¸¸æˆç»“æŸï¼ä½ è¸©åˆ°åœ°é›·äº†ï¼';
                return;
            }
            
            // å¦‚æœæ˜¯ç©ºç™½ï¼Œé€’å½’ç¿»å¼€ç›¸é‚»æ ¼å­
            if (gameState.board[row][col].adjacentMines === 0) {
                for (let r = row - 1; r <= row + 1; r++) {
                    for (let c = col - 1; c <= col + 1; c++) {
                        // è·³è¿‡è‡ªèº«
                        if (r === row && c === col) continue;
                        revealCell(r, c);
                    }
                }
            }
            
            renderBoard();
        }
        
        // ç¿»å¼€æ‰€æœ‰åœ°é›·ï¼ˆæ¸¸æˆç»“æŸæ—¶ï¼‰
        function revealAllMines() {
            for (const mine of gameState.mines) {
                gameState.board[mine.row][mine.col].isRevealed = true;
            }
            renderBoard();
        }
        
        // æ£€æŸ¥æ¸¸æˆèƒœåˆ©æ¡ä»¶
        function checkGameStatus() {
            const diff = DIFFICULTIES[gameState.difficulty];
            const totalSafeCells = diff.rows * diff.cols - diff.mines;
            
            if (gameState.revealed.length === totalSafeCells) {
                gameState.gameWon = true;
                resetButton.textContent = 'ğŸ˜';
                gameMessage.textContent = 'æ­å–œï¼ä½ èµ¢äº†ï¼';
                clearInterval(gameState.timer);
            }
        }
        
        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            gameState.startTime = new Date();
            gameState.timer = setInterval(() => {
                const seconds = Math.floor((new Date() - gameState.startTime) / 1000);
                timerElement.textContent = seconds;
            }, 1000);
        }
        
        // æ›´æ–°æœ€å¤§åœ°é›·æ•°æ˜¾ç¤º
        function updateMaxMinesDisplay() {
            const rows = parseInt(customRowsInput.value) || 9;
            const cols = parseInt(customColsInput.value) || 9;
            const totalCells = rows * cols;
            const maxMines = Math.min(Math.floor(totalCells * 0.75),totalCells-9);
            maxMinesElement.textContent = maxMines;
            customMinesInput.max = maxMines;
        }
        
        // éªŒè¯è‡ªå®šä¹‰è®¾ç½®
        function validateCustomSettings() {
            const rows = parseInt(customRowsInput.value);
            const cols = parseInt(customColsInput.value);
            const mines = parseInt(customMinesInput.value);
            
            // éªŒè¯è¾“å…¥å€¼
            if (isNaN(rows) || isNaN(cols) || isNaN(mines)) {
                gameMessage.textContent = 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µï¼';
                return false;
            }
            
            if (rows < 1 || rows > 30) {
                gameMessage.textContent = 'è¡Œæ•°å¿…é¡»æ˜¯1-30ä¹‹é—´çš„æ•´æ•°ï¼';
                return false;
            }
            
            if (cols < 1 || cols > 30) {
                gameMessage.textContent = 'åˆ—æ•°å¿…é¡»æ˜¯1-30ä¹‹é—´çš„æ•´æ•°ï¼';
                return false;
            }
            
            const totalCells = rows * cols;
            const maxMines = Math.min(Math.floor(totalCells * 0.75),totalCells - 9);
            
            if (mines < 1 || mines > maxMines) {
                minesError.style.display = 'block';
                gameMessage.textContent = `åœ°é›·æ•°èŒƒå›´ä¸º1-${maxMines}ï¼`;
                return false;
            }
            
            minesError.style.display = 'none';
            return true;
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        resetButton.addEventListener('click', () => {
            // æ¸…é™¤è®¡æ—¶å™¨
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            initGame();
        });
        
        difficultyButtons.forEach(button => {
            button.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                difficultyButtons.forEach(b => b.classList.remove('active'));
                // ä¸ºå½“å‰æŒ‰é’®æ·»åŠ activeç±»
                this.classList.add('active');
                
                if (this !== customDifficultyButton) {
                    gameState.difficulty = this.dataset.difficulty;
                    initGame();
                }
            });
        });
        
        // è‡ªå®šä¹‰éš¾åº¦æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        customDifficultyButton.addEventListener('click', function() {
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»ï¼Œå½“å‰æŒ‰é’®æ·»åŠ activeç±»
            difficultyButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // è®¾ç½®é»˜è®¤å€¼
            const diff = DIFFICULTIES[gameState.difficulty === 'custom' ? 'custom' : 'beginner'];
            customRowsInput.value = diff.rows;
            customColsInput.value = diff.cols;
            customMinesInput.value = diff.mines;
            updateMaxMinesDisplay();
            
            // æ˜¾ç¤ºè‡ªå®šä¹‰è®¾ç½®å¼¹çª—
            customModal.classList.add('active');
        });
        
        // è®¡ç®—æœ€å¤§åœ°é›·æ•°
        customRowsInput.addEventListener('input', updateMaxMinesDisplay);
        customColsInput.addEventListener('input', updateMaxMinesDisplay);
        
        // å–æ¶ˆè‡ªå®šä¹‰è®¾ç½®
        cancelCustomButton.addEventListener('click', function() {
            customModal.classList.remove('active');
            // é‡ç½®è‡ªå®šä¹‰æŒ‰é’®çŠ¶æ€
            difficultyButtons.forEach(b => {
                if (b.dataset.difficulty === gameState.difficulty) {
                    b.classList.add('active');
                }
            });
        });
        
        // ç¡®è®¤è‡ªå®šä¹‰è®¾ç½®
        confirmCustomButton.addEventListener('click', function() {
            if (validateCustomSettings()) {
                // æ›´æ–°è‡ªå®šä¹‰éš¾åº¦è®¾ç½®
                DIFFICULTIES.custom.rows = parseInt(customRowsInput.value);
                DIFFICULTIES.custom.cols = parseInt(customColsInput.value);
                DIFFICULTIES.custom.mines = parseInt(customMinesInput.value);
                
                gameState.difficulty = 'custom';
                customModal.classList.remove('active');
                
                // æ›´æ–°æ¶ˆæ¯åŒºåŸŸ
                gameMessage.textContent = `è‡ªå®šä¹‰éš¾åº¦: ${DIFFICULTIES.custom.rows}Ã—${DIFFICULTIES.custom.cols}, åœ°é›·: ${DIFFICULTIES.custom.mines}`;
                
                // åˆå§‹åŒ–æ¸¸æˆ
                initGame();
            }
        });
        
        // ä½œå¼ŠæŒ‰é’®ç‚¹å‡»äº‹ä»¶
        cheatButton.addEventListener('click', function() {
            if (gameState.gameOver || gameState.gameWon) return;
            
            gameState.cheatMode = !gameState.cheatMode;
            
            if (gameState.cheatMode) {
                this.textContent = "ä½œå¼Šæ¨¡å¼ï¼šå¼€";
                this.classList.add('active');
                gameMessage.textContent = "AIæç¤ºå·²å¼€å¯ - ç»¿è‰²æ ¼å­å®‰å…¨ï¼Œçº¢è‰²æ ¼å­æ˜¯åœ°é›·";
                provideCheatHint();
            } else {
                this.textContent = "ä½œå¼Šæ¨¡å¼ï¼šå…³";
                this.classList.remove('active');
                gameMessage.textContent = "AIæç¤ºå·²å…³é—­";
                
                // ç§»é™¤æ‰€æœ‰æç¤º
                const hints = document.querySelectorAll('.hint-safe, .hint-mine');
                hints.forEach(cell => {
                    cell.classList.remove('hint-safe', 'hint-mine');
                });
            }
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
        // è®¡ç®—æœ€å¤§åœ°é›·æ•°
        updateMaxMinesDisplay();
    </script>
</body>
</html>